---
import HeaderLink from "./HeaderLink.astro";
import ThemeToggle from "./ThemeToggle.astro";
import Omnibar from "./Omnibar.astro";
import { SITE_TITLE } from "../consts";
---

<header
  class="fixed inset-x-0 top-0 z-50 transform bg-white shadow-header transition-all duration-200 ease-in-out dark:bg-brand-dark"
>
  <nav
    class="mx-auto flex max-w-screen-2xl items-center justify-between gap-3 px-4 py-3 sm:px-6 lg:px-8"
  >
    <a href="/" class="logo inline-flex items-center" aria-label={SITE_TITLE}>
      <img
        class="h-7 w-7"
        src="/img/favicons/favicon-96x96.png"
        alt="Logo"
      />
    </a>
    <div class="internal-links flex items-center gap-2 text-sm sm:text-base">
      <HeaderLink href="/">Home</HeaderLink>
      <HeaderLink href="/ideas">Ideas</HeaderLink>
      <HeaderLink href="/about">About</HeaderLink>
      <div
        class="js-missing hidden rounded-md bg-amber-100 px-2 py-1 text-xs font-semibold uppercase tracking-wide text-amber-700"
        title="Search and other important features require JavaScript"
      >
        ⚠️ JavaScript Disabled
      </div>
      <div class="search-wrapper js-required hidden items-center sm:flex">
        <Omnibar />
      </div>
      <div class="theme-toggle-wrapper flex items-center">
        <ThemeToggle />
      </div>
    </div>
  </nav>
</header>

<script>
  function initHeadroom() {
    const header = document.querySelector("header");
    if (!header) return;

    let lastScrollY = window.scrollY;
    const tolerance = { up: 5, down: 5 };
    let lastDirection = "up";
    const offset = 0;

    function update() {
      const currentScrollY = window.scrollY;
      const direction = currentScrollY > lastScrollY ? "down" : "up";
      const toleranceExceeded =
        Math.abs(currentScrollY - lastScrollY) >=
        (direction === "down" ? tolerance.down : tolerance.up);

      if (toleranceExceeded && header) {
        if (direction === "down" && currentScrollY > offset) {
          header.classList.add("headroom--unpinned");
          header.classList.remove("headroom--pinned");
        } else if (direction === "up") {
          header.classList.add("headroom--pinned");
          header.classList.remove("headroom--unpinned");
        }
        lastDirection = direction;
      }

      lastScrollY = currentScrollY;
    }

    window.addEventListener("scroll", update, { passive: true });
  }

  // Initialize when DOM is loaded
  document.addEventListener("DOMContentLoaded", initHeadroom);
</script>

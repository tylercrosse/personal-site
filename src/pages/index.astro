---
import { getCollection } from "astro:content";

import BaseLayout from "../layouts/BaseLayout.astro";
import FormattedDate from "../components/FormattedDate.astro";
import readingTime from "reading-time";

const posts = (await getCollection("ideas"))
  .filter((post) => {
    return import.meta.env.DEV || !post.data.draft;
  })
  .sort((a, b) => {
    const aDate = a.data.pubDate || a.data.date;
    const bDate = b.data.pubDate || b.data.date;
    return new Date(bDate || 0).valueOf() - new Date(aDate || 0).valueOf();
  });

const allPostsData = posts.map((post) => {
  const slug = post.id.replace(/(\/index)?\.(md|mdx)$/, "");
  const stats = readingTime(post.body || "");
  return {
    id: post.id,
    slug,
    title: post.data.title,
    description: post.data.description,
    date: post.data.date,
    updated: post.data.updated,
    type: post.data.type,
    status: post.data.status,
    tags: post.data.tags || [],
    image: post.data.image,
    draft: post.data.draft,
    readingTimeText: stats.text,
  };
});

const greetingWords = ["Hi,", "I'm", "Tyler"];
---

<BaseLayout title="Home">
  <section class="flex min-h-[40vh] flex-col items-center justify-center gap-6 text-center">
    <h1 class="flex flex-wrap justify-center gap-3 text-5xl font-serif font-bold text-slate-900 dark:text-white sm:text-6xl">
      {greetingWords.map((word, index) => (
        <span class="word-slide-in" style={{ animationDelay: `${index * 0.05}s` }}>
          {word}
        </span>
      ))}
    </h1>
    <p
      class="max-w-2xl text-lg text-slate-600 animate-fade-scale dark:text-slate-300"
      style={{ animationDelay: "0.4s" }}
    >
      I'm a software engineer with a passion for building things.<br />
      I'm currently studying machine learning and systems at Georgia Tech. My research interests include: Mechanistic
      Interpretability, AI Alignment, Deep Learning Theory
    </p>
  </section>
  <section class="space-y-6 animate-fade-scale" style={{ animationDelay: "0.6s" }} data-pagefind-ignore>
    <h2 class="text-2xl font-serif font-semibold text-slate-900 dark:text-white">Writing</h2>
    <ul class="space-y-4">
      {allPostsData.map((post) => (
        <li>
          <a
            href={`/ideas/${post.slug}/`}
            class="group block rounded-xl border border-transparent bg-white/60 p-4 shadow-sm transition hover:border-accent hover:bg-accent/10 dark:bg-slate-900/60 dark:hover:bg-accent/20"
          >
            <div class="flex flex-wrap items-center gap-2 text-sm text-slate-500 dark:text-slate-400">
              {post.date && (
                <span class="font-medium text-slate-600 dark:text-slate-300">
                  <FormattedDate date={post.date} />
                </span>
              )}
              {post.draft && (
                <span class="rounded-full bg-amber-100 px-2 py-1 text-[0.6rem] font-semibold uppercase tracking-wide text-amber-700 dark:bg-amber-500/20 dark:text-amber-200">
                  Draft
                </span>
              )}
              <span class="ml-auto text-xs uppercase tracking-wide">{post.readingTimeText}</span>
            </div>
            <h3 class="mt-2 text-xl font-serif font-semibold text-slate-900 group-hover:text-accent dark:text-white">
              {post.title}
            </h3>
            {post.description && (
              <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">{post.description}</p>
            )}
          </a>
        </li>
      ))}
    </ul>
  </section>
</BaseLayout>
